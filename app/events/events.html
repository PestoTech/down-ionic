<ion-view id="events" hide-back-button="true" can-swipe-back="false">
  <ion-nav-title>
    <span id="nav-logo">Down</span>
  </ion-nav-title>
  <ion-content>
    <ion-list class="list-avatar" ng-class="{moving: events.moving}">
      <!-- We might need to use `track by item.id` for the animations to work -->
      <ion-item ng-repeat="item in events.items"
                ng-class="{'item-divider': item.isDivider, 'item-avatar': !item.isDivider, 'item-icon-right': !item.isDivider, updated: item.wasUpdated, 'item-reordering': item.isReordering, last: $last}"
                ng-click="!item.isDivider ? (item.wasJoined ? null : events.toggleIsExpanded(item)) : null"
                ng-style="{top: events.moving ? item.top+'px': none, right: item.right+'px'}">
        <!-- Divider -->
        <span ng-if="item.isDivider">{{item.title}}</span>

        <!-- Facebook Friend -->
        <img ng-src="{{item.fromUser.imageUrl}}" alt="{{item.fromUser.name}}">
        <h2>{{item.event.title}}</h2>
        <p ng-if="item.wasJoined">{{item.event.latestMessage}}</p>
        <p ng-if="!item.wasJoined">Suggested by {{item.fromUser.name}}</p>
        <span class="updated-at">{{item.createdAt | date:'shortTime' | lowercase}}</span>
        <i class="fa" ng-if="!item.wasJoined"
           ng-class="{'fa-chevron-down': !item.isExpanded, 'fa-chevron-up': item.isExpanded}"
           ></i>
        <i class="fa fa-chevron-right" ng-if="item.wasJoined"></i>
        <div ng-if="item.isExpanded" class="event-details">
          <div class="event-detail" ng-if="item.event.datetime">
            <i class="fa fa-calendar-o"></i>
            <div>
              <div>{{item.event.datetime | date:'EEEE, MMM d'}}</div>
              <div>{{item.event.datetime | date:'shortTime' | lowercase}}</div>
            </div>
          </div>
          <div class="event-detail" ng-if="item.event.place">
            <i class="fa fa-map-marker"></i>
            <span>{{item.event.place.name}}</span>
          </div>
          <div class="event-detail" ng-if="item.event.comment">
            <i class="fa fa-comment-o"></i>
            <span>{{item.event.comment}}</span>
          </div>
          <div class="respond-buttons">
            <button class="respond"
                    ng-click="events.acceptInvitation(item, $event)"
                    ontouchstart
                    >Down</button>
            <button class="respond"
                    ng-click="events.maybeInvitation(item, $event)"
                    ontouchstart
                    >Maybe</button>
            <button class="respond"
                    ng-class="{'activated': events.itemWasDeclined(item)}"
                    ng-click="events.declineInvitation(item, $event)"
                    ontouchstart
                    >Can't</button>
          </div>
        </div>
      </ion-item>
    </ion-list>
  </ion-content>
  <ion-footer-bar class="bar-light" keyboard-attach>
    <div id="new-event-details">
      <input id="suggestion" placeholder="Suggest something to do..."
             ng-model="events.newEvent.title">
      <div class="event-detail" ng-if="events.newEvent.hasDate">
        <i class="fa fa-calendar-o"></i>
        <div>
          <div>{{events.newEvent.datetime | date:'EEEE, MMM d'}}</div>
          <div>{{events.newEvent.datetime | date:'shortTime' | lowercase}}</div>
        </div>
      </div>
      <div class="event-detail" ng-if="events.newEvent.hasPlace">
        <i class="fa fa-map-marker"></i>
        <span>{{events.newEvent.place.name}}</span>
      </div>
      <div class="event-detail" ng-show="events.newEvent.hasComment">
        <i class="fa fa-comment-o"></i>
        <textarea id="comment" ng-model="events.newEvent.comment" msd-elastic
                  placeholder="Add a comment..."></textarea>
      </div>
    </div>
    <div id="actions" class="footer-subheader">
      <a href="" ng-click="events.toggleHasDate()">
        <i class="fa fa-calendar-o"
           ng-class="{selected: events.newEvent.hasDate}"></i>
      </a>
      <a href="" ng-click="events.toggleHasPlace()">
        <i class="fa fa-map-marker"
           ng-class="{selected: events.newEvent.hasPlace}"></i>
      </a>
      <a href="" ng-click="events.toggleHasComment()">
        <i class="fa fa-comment-o"
           ng-class="{selected: events.newEvent.hasComment}"></i>
      </a>
      <button id="suggest" ng-click="events.inviteFriends()"
              ng-disabled="!events.newEvent.title">
        <i class="fa fa-arrow-right" ng-class="{enabled: events.newEvent.title}"
           ></i>
      </button>
    </div>
  </ion-footer-bar>
</ion-view>
